#include "../include/consola.h"

t_log* logger;

int main(int argc, char** argv) {
	// Level trace para que hagamos logs debugs y trace
	// As√≠ los logs minimos quedan al level info
	logger = log_create("Consola.log", "logger", true, LOG_LEVEL_TRACE);

	if (argc < 3) {
		log_error(logger, "Se necesitan mas argumentos para inicializar correctamente la consola");
		return EXIT_FAILURE;
	}

	char* config_path = argv[1];
	char* pseudo_path = argv[2];

	log_debug(logger, "config: %s", config_path);
	log_debug(logger, "pseudo: %s", pseudo_path);

	int kernel_fd = procesar_config();

	return 0;
}

int procesar_config(char *config_path) {
	t_config* config = config_create(config_path);

	if (config == NULL) {
		log_error(logger, "No se pudo abrir el archivo de configuracion en ese path");
		exit(EXIT_FAILURE);
	}

	char* ip_kernel = config_get_string_value(config, "IP_KERNEL");
	char* puerto_kernel = config_get_string_value(config, "PUERTO_KERNEL");

	log_debug(logger, "ip: %s", ip_kernel);
	log_debug(logger, "puerto: %s", puerto_kernel);

	int conexion_kernel = conect_to_kernel(ip_kernel, puerto_kernel);

	if(conexion_kernel == -1) {
		log_info(logger, "No se ha podido conectar con el KERNEL");
		exit(EXIT_FAILURE);
	}

	log_info(logger, "Se ha conectado con el KERNEL");
	config_destroy(config);

	return conexion_kernel;
}

